USE WAREHOUSE FSDA;
USE DATABASE FSDAASSIGNMENTS;

-----   CREATE TABLE AND LOAD THE TABLE IN DATABSE
-----1) LOAD THE GIVEN DATABASE INTO SNOWFLAKE WITH PRIMARY KEY TO ORDER_DATE COLUMN.

CREATE OR REPLACE TABLE RR_SALESDATA
   (  ORDER_ID VARCHAR(40),
      ORDER_DATE VARCHAR(12) PRIMARY KEY,
      SHIP_DATE VARCHAR(12),
      SHIP_MODE VARCHAR(16),
      CUSTOMER_NAME VARCHAR(40),
      SEGMENT VARCHAR(20),
      STATE VARCHAR(10),
      COUNTRY VARCHAR(12),
      MARKET VARCHAR(14),
      REGION VARCHAR(12),
      PRODUCT_ID VARCHAR(20),
      CATEGORY VARCHAR(12),
      SUB_CATEGORY VARCHAR(10),
      PRODUCT_NAME VARCHAR(40),
      SALES NUMBER(10,8),
      QUANTITY INT,
      DISCOUNT FLOAT,
      PROFIT FLOAT,
      SHIPPING_COST FLOAT,
      ORDER_PRIORITY VARCHAR(40),
      YEAR NUMBER(8)
   );
   
   DESCRIBE TABLE RR_SALESDATA;
   SELECT * FROM RR_SALESDATA;
   
   -----2) SET PRIMARY KEY.
   -----3) CHANGE THE PRIMARY KEY TO ORDER_ID CCOLUMN.
   
   ALTER TABLE RR_SALESDATA
   DROP PRIMARY KEY;
   
   -----4) ADD PRIMARY KEY IN ORDER_ID COLUMN.
   
   ALTER TABLE RR_SALESDATA
   ADD PRIMARY KEY (ORDER_ID);
   DESCRIBE TABLE RR_SALESDATA;
   
   -----5) CHECK THE DATA TYPE FOR ORDER DATE AND SHIP DATE AND MENTION IN WHAT DATA TYPE IT SHOULD BE.
   
   SELECT * FROM RR_SALESDATA
   ORDER BY ORDER_DATE AND SHIP_DATE;
   
   -----6) CREATE A NEW COLUMN ORDER_EXTRACT AND EXTRACT THE NUMBER AFTER THE LAST '-' FROM ORDER_ID COLUMN.
   
   ALTER TABLE RR_SALESDATA
   ADD COLUMN ORDER_EXTRACT VARCHAR(40);
   DESCRIBE TABLE RR_SALESDATA;
   
   UPDATE RR_SALESDATA
   SET ORDER_EXTRACT = SUBSTR(ORDER_ID,9);
   SELECT ORDER_ID,ORDER_EXTRACT FROM RR_SALESDATA;
   
   -----7) CREATE A NEW COLUMN DISCOUNT_FLAG AND CATEGORIZE IT BASED ON DISCOUNT. USE 'YES' IF DISCOUNT IS GREATER THAN ZERO ELSE 'NO'.
   
   SELECT ORDER_ID,DISCOUNT,
        CASE
          WHEN DISCOUNT>0 THEN 'YES'
          ELSE 'NO'
        END AS DISCOUNT_FLAG
   FROM RR_SALESDATA;
   
   
   
------8) CREATE A NEW CCOLUMN PROCESS_DAYS AND CALCULATE HOW MANY DAYS IT TAKES FOR EACH ORDER_ID TO PROCESS FROM THE ORDER TO ITS SHIPMENT.

   SELECT ORDER_ID,ORDER_DATE,SHIP_DATE,
   DATEDIFF(DAY,SHIP_DATE,ORDER_DATE) AS PROCESS_DAYS
   FROM RR_SALESDATA;
  
------9) CREATE A COLUMN RATINGS AND THEN BASED ON THE PROCESS DATES GIVE RATING LIKE BELOW :
-------- A: IF PROCESS DAYS LESS THAN OR EQUAL TO 3 DAYS THEN RATIONS SHOULD BE 5
-------  B: IF PROCESS DAYS ARE GREATER THAN 3 AND LESS THAN OR EQUAL TO 6 THEN RATINGS SHOULD BE 4
-------- C: IF PROCESS DAYS ARE GREATER THAN 6 AND LESS THAN OR EQUAL TO 10 THEN RATINGS SHOULD BE 3
-------- D: IF PROCESS DAYS ARE GREATER THAN 10 THEN RATINGS SHOULD BE 2.
  
   SELECT ORDER_ID,ORDER_DATE,SHIP_DATE,
   DATEDIFF(DAY,SHIP_DATE,ORDER_DATE) AS PROCESS_DAYS,
   CASE 
        WHEN PROCESS_DAYS <=3 THEN 5
        WHEN PROCESS_DAYS BETWEEN 3 AND 6 THEN 4
        WHEN PROCESS_DAYS BETWEEN 6 AND 10 THEN 3
        ELSE 2
   END AS RATINGS
   FROM RR_SALESDATA;
   
